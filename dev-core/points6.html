<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P6</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-delaunay@5.0.0/dist/d3-delaunay.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<script>
    // Set up scene, camera, renderer
            var scene = new THREE.Scene();
            var renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setAnimationLoop( animate );
            document.body.appendChild( renderer.domElement );

            var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
            camera.position.set( 0, 0, 0 );
            const axesHelper = new THREE.AxesHelper( 5 ); scene.add( axesHelper );
            var controls = new THREE.OrbitControls(camera, renderer.domElement);

           // Generate points
    var points = [
        [100, 100],
        [300, 150],
        [200, 300],
        [400, 400]
    ];

    // Create Voronoi cells using d3-delaunay
    const delaunay = d3.Delaunay.from(points);
    const voronoi = delaunay.voronoi([0, 0, window.innerWidth, window.innerHeight]);

    // Visualize bounding box
    var bboxGeometry = new THREE.PlaneGeometry(window.innerWidth, window.innerHeight);
    var bboxMaterial = new THREE.MeshBasicMaterial({color: 0x00ff00, wireframe: true});
    var bbox = new THREE.Mesh(bboxGeometry, bboxMaterial);
    bbox.position.set(window.innerWidth / 2, window.innerHeight / 2, -1);
    scene.add(bbox);

    // Visualize cells
    for (let i = 0; i < points.length; i++) {
        const cell = voronoi.cellPolygon(i);
        if (cell) {
            const vertices = [];
            cell.forEach(point => {
                if (point[0] >= 0 && point[0] <= window.innerWidth && point[1] >= 0 && point[1] <= window.innerHeight) {
                    vertices.push(point[0], point[1], 0);
                }
            });
            if (vertices.length > 0) {
                vertices.push(vertices[0], vertices[1], vertices[2]); // Close the polygon

                var geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices.flat(), 3));
                var material = new THREE.MeshBasicMaterial({color: 0xffffff * Math.random(), side: THREE.DoubleSide, wireframe: true});
                var mesh = new THREE.Mesh(geometry, material);
                scene.add(mesh);
            }
        }
    }

    // Visualize points
    points.forEach(point => {
        var dotGeometry = new THREE.CircleGeometry(5, 32);
        var dotMaterial = new THREE.MeshBasicMaterial({color: 0xff0000});
        var dot = new THREE.Mesh(dotGeometry, dotMaterial);
        dot.position.set(point[0], point[1], 0);
        scene.add(dot);
    });

    camera.position.z = 1000;

    var animate = function () {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    };

    animate();
</script>
</body>
</html>

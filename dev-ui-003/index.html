<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geodeck</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <header>
        <h1>Geodeck</h1>
    </header>
    <main>
        <div class="card-deck" id="cardDeck">
            <div class="card" id="coreCard1">
                <h2>Drill Core #1</h2>
                <h3>Location</h3>
                <div id="map1" style="background-color:black;width:200px;height:200px;"></div>
                <p>Latitude:</p>
                <input type="number" id="lat1" value="51.505" step="any">
                <p>Longitude:</p>
                <input type="number" id="lon1" value="-0.09" step="any">
                <p>Height in Meter (optional):</p>
                <input type="number" id="height1" value="100" step="any">
                <div id="layers1">
                    <div class="layer">
                        <h3>Layer 1</h3>
                        <p>
                            Name:
                            <input type="text" name="layerName[]" value="Layer 1">
                            <input type="color" name="layerColor[]" value="#1976d2" style="vertical-align: middle;">
                        </p>
                        <p>Thickness in Meter:</p>
                        <input type="number" name="layerDepth[]" value="10" step="any">
                    </div>
                </div>
                <div class="add-layer-btn">
                    <button onclick="addLayer('layers1')">Add Layer</button>
                </div>
            </div>
            <button id="addCoreBtn" style="height:40px;margin: auto 0;">+ Add Drill Core</button>
            <div class="card" id="previewCard">
                <h2>Preview</h2>
                <p>Overview</p>
                <div id="mapPreview" style="background-color:black;width:200px;height:200px;"></div>
                <p>Visualization</p>
                <p>Statistic</p>
            </div>
        </div>
    </main>
    <footer>
        <p>&copy; 2025 Geodeck</p>
    </footer>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Leaflet Maps initialisieren
        const coords = [
            [51.505, -0.09],
            [51.49, -0.1]
        ];
        const markers = [];

        // Drill Core #1 Map
        const map1 = L.map('map1').setView(coords[0], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map1);
        markers[1] = null;
        map1.on('click', function(e) {
            document.getElementById('lat1').value = e.latlng.lat.toFixed(6);
            document.getElementById('lon1').value = e.latlng.lng.toFixed(6);
            if (markers[1]) {
                markers[1].setLatLng(e.latlng);
            } else {
                markers[1] = L.marker(e.latlng).addTo(map1);
            }
        });
        // Initial Marker
        const lat1 = parseFloat(document.getElementById('lat1').value);
        const lon1 = parseFloat(document.getElementById('lon1').value);
        if (!isNaN(lat1) && !isNaN(lon1)) {
            markers[1] = L.marker([lat1, lon1]).addTo(map1);
        }

        // Preview Map
        const mapPreview = L.map('mapPreview').setView(coords[1], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(mapPreview);

        // Layer dynamisch hinzufügen
        function addLayer(layersId) {
            const layersDiv = document.getElementById(layersId);
            const layerCount = layersDiv.querySelectorAll('.layer').length + 1;
            const div = document.createElement('div');
            div.className = 'layer';
            div.innerHTML = `
                <h3>Layer ${layerCount}</h3>
                <p>
                    Name:
                    <input type="text" name="layerName[]" value="Layer ${layerCount}">
                    <input type="color" name="layerColor[]" value="#1976d2" style="vertical-align: middle;">
                </p>
                <p>Thickness in Meter:</p>
                <input type="number" name="layerDepth[]" value="10" step="any">
            `;
            layersDiv.appendChild(div);
        }

        // Drill Core hinzufügen
        document.getElementById('addCoreBtn').onclick = function() {
            // Prüfe, ob Core #2 schon existiert
            if (document.getElementById('coreCard2')) return;
            const cardDeck = document.getElementById('cardDeck');
            const previewCard = document.getElementById('previewCard');
            // Neue Karte für Drill Core #2
            const coreCard2 = document.createElement('div');
            coreCard2.className = 'card';
            coreCard2.id = 'coreCard2';
            coreCard2.innerHTML = `
                <h2>Drill Core #2</h2>
                <h3>Location</h3>
                <div id="map2" style="background-color:black;width:200px;height:200px;"></div>
                <p>Latitude:</p>
                <input type="number" id="lat2" value="51.51" step="any">
                <p>Longitude:</p>
                <input type="number" id="lon2" value="-0.1" step="any">
                <p>Height in Meter (optional):</p>
                <input type="number" id="height2" value="100" step="any">
                <div id="layers2">
                    <div class="layer">
                        <h3>Layer 1</h3>
                        <p>
                            Name:
                            <input type="text" name="layerName[]" value="Layer 1">
                            <input type="color" name="layerColor[]" value="#1976d2" style="vertical-align: middle;">
                        </p>
                        <p>Thickness in Meter:</p>
                        <input type="number" name="layerDepth[]" value="10" step="any">
                    </div>
                </div>
                <div class="add-layer-btn">
                    <button onclick="addLayer('layers2')">Add Layer</button>
                </div>
            `;
            cardDeck.insertBefore(coreCard2, previewCard);

            // Leaflet Map für Drill Core #2
            setTimeout(() => {
                const map2 = L.map('map2').setView(coords[1], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map2);
                markers[2] = null;
                map2.on('click', function(e) {
                    document.getElementById('lat2').value = e.latlng.lat.toFixed(6);
                    document.getElementById('lon2').value = e.latlng.lng.toFixed(6);
                    if (markers[2]) {
                        markers[2].setLatLng(e.latlng);
                    } else {
                        markers[2] = L.marker(e.latlng).addTo(map2);
                    }
                });
                // Initial Marker
                const lat2 = parseFloat(document.getElementById('lat2').value);
                const lon2 = parseFloat(document.getElementById('lon2').value);
                if (!isNaN(lat2) && !isNaN(lon2)) {
                    markers[2] = L.marker([lat2, lon2]).addTo(map2);
                }
            }, 0);
        };
    </script>
</body>
</html>